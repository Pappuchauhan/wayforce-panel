import{r as x,S as q,j as e,t as p,d as a,u as X}from"./index-Lpbe05IJ.js";import{l as ee,f as se}from"./Layout-E0zCJv-y.js";import{d as B}from"./ProductServices-y9ORDKWk.js";import{d as _,u as ae}from"./index-gzY5sSy9.js";import{T as O,D as le,u as Z,M as G}from"./DrawerButton-5jCKX6Zg.js";import{u as te}from"./useFilter-lJG91-FU.js";import{P as re}from"./PageTitle-OfFMKDS4.js";import{D as J,E as ie}from"./EditDeleteButton-0uGBp5za.js";import{C as K,S as ne,B as de}from"./BulkActionDrawer-kaRh0qfd.js";import{u as oe,E as I}from"./index.esm-VPrTnZrZ.js";import{I as z}from"./InputArea-z21zghSD.js";import{I as H}from"./InputValue-tbn5PVZc.js";import{L as v}from"./LabelArea-4W0PbWQ4.js";import"./httpService-NO-zZZyR.js";import{a as Y,n as $}from"./toast-RpwxFr5k.js";import"./index-3LsQAbHt.js";import{u as Q}from"./useUtilsFunction-1L03nbkL.js";import{S as me}from"./SwitchToggle-Cep5Z76n.js";import{a as ce}from"./index.prod-5YAP6x9i.js";import{I as pe}from"./ImageUpload-S3Q0N1uC.js";import{T as xe}from"./TableLoading-HCS0Y3aW.js";import{N as ge}from"./NotFound-76oDYWbd.js";import"./exportFromJSON-YB29QCxh.js";import"./iconBase-9eKqCuwM.js";import"./SelectLanguageTwo-WxBRNe0b.js";import"./LanguageServices-pJX5Surk.js";import"./spinner-R50PTWTV.js";import"./AdminServices-sLHuluOr.js";import"./Tooltip-gGcpELYQ.js";import"./index-zNyNCIWn.js";import"./ParentCategory-TQN4LMe5.js";import"./SettingServices-GiP1SmAf.js";import"./useDispatch-40nVW7Rg.js";import"./index-4c895vgV.js";import"./tslib.es6-YYMLUA4o.js";const ue=l=>{const{isDrawerOpen:i,closeDrawer:j,setIsUpdate:o,lang:m}=x.useContext(q),[S,C]=x.useState(""),[T,N]=x.useState(m),[b,g]=x.useState({}),[u,D]=x.useState(!1),[k,s]=x.useState(!1),[h,n]=x.useState(!1),[f,w]=x.useState(""),{currency:P}=Q(),{register:F,handleSubmit:U,setValue:d,clearErrors:y,formState:{errors:V},getValues:R}=oe(),L=async c=>{var A,E;try{n(!0);const r=new FormData;if(r.append("title",c.title),r.append("couponCode",c.couponCode),r.append("endTime",c.endTime),r.append("minimumAmount",c.minimumAmount),r.append("status",u?"show":"hide"),r.append("discountType[type]",k?"percentage":"fixed"),r.append("discountType[value]",c.discountPercentage),r.append("productType",c.productType),r.append("logo",f),l){const t=await B.updateCoupon(l,r);o(!0),n(!1),$(t.message),j()}else{const t=await B.addCoupon(r);o(!0),n(!1),$(t.message),j()}}catch(r){Y(((E=(A=r==null?void 0:r.response)==null?void 0:A.data)==null?void 0:E.message)||(r==null?void 0:r.message)),n(!1),j()}},M=c=>{N(c),Object.keys(b).length>0&&d("title",b.title[c||"en"])};return x.useEffect(()=>{if(!i){g({}),d("title"),d("productType"),d("couponCode"),d("endTime"),d("discountPercentage"),d("minimumAmount"),d("logo"),C(""),y("title"),y("productType"),y("couponCode"),y("endTime"),y("discountPercentage"),y("minimumAmount"),y("logo"),N(m),d("language",T);return}l&&(async()=>{var c,A,E,r;try{const t=await B.getCouponById(l);t&&(g(t),d("title",t.title),d("productType",t.productType),d("couponCode",t.couponCode),d("logo",t.logo),d("endTime",_(t.endTime).format("YYYY-MM-DD HH:mm")),d("discountPercentage",(c=t.discountType)==null?void 0:c.value),d("minimumAmount",t.minimumAmount),D(t.status==="show"),s(((A=t.discountType)==null?void 0:A.type)==="percentage"),C(t.logo))}catch(t){Y(((r=(E=t==null?void 0:t.response)==null?void 0:E.data)==null?void 0:r.message)||(t==null?void 0:t.message))}})()},[l,d,i,y,T,m]),{register:F,handleSubmit:U,onSubmit:L,errors:V,setImageUrl:C,imageUrl:S,published:u,setPublished:D,currency:P,discountType:k,isSubmitting:h,setDiscountType:s,handleSelectLanguage:M,couponImage:f,setCouponImage:w,getValues:R}},he=({title:l,handleProcess:i,processOption:j,product:o,handleIsCombination:m})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:`${o?"mb-3 flex flex-wrap justify-end items-center mr-8":"mb-3"}`,children:e.jsxs("div",{className:"flex flex-wrap items-center",children:[o?e.jsx("label",{className:"block text-base font-normal text-orange-500 dark:text-orange-400 mx-4",children:"Does this product have variants?"}):e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:l}),e.jsx(ce,{onChange:o?m:i,checked:j,className:"react-switch",uncheckedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingRight:45,paddingTop:1},children:"Fixed"}),width:125,height:33,handleDiameter:28,offColor:"#E53E3E",onColor:"#2F855A",checkedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingLeft:50,paddingTop:1},children:"Percentage"})})]})})}),W=({id:l})=>{const{register:i,handleSubmit:j,onSubmit:o,errors:m,setImageUrl:S,imageUrl:C,published:T,setPublished:N,currency:b,discountType:g,setDiscountType:u,isSubmitting:D,couponImage:k,setCouponImage:s,handleSelectLanguage:h,getValues:n}=ue(l);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative  p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 ",children:l?e.jsx(O,{register:i,title:p("UpdateCoupon"),description:p("UpdateCouponDescription")}):e.jsx(O,{register:i,title:p("AddCoupon"),description:p("AddCouponDescription")})}),e.jsx(ee.Scrollbars,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:j(o),children:[e.jsxs("div",{className:"px-6 pt-8 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(v,{label:"Category Image"}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(pe,{name:"logo",onUpload:f=>s(f)}),n("logo")!==void 0&&n("logo")!=""&&e.jsx("img",{src:n("logo"),alt:"coupon",style:{height:"150px"}})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(v,{label:p("CampaignName")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(z,{register:i,label:"Coupon title",name:"title",type:"text",placeholder:p("CampaignName")}),e.jsx(I,{errorName:m.title})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(v,{label:p("CampaignCode")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(z,{register:i,label:"Coupon Code",name:"couponCode",type:"text",placeholder:p("CampaignCode")}),e.jsx(I,{errorName:m.couponCode})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(v,{label:p("CouponValidityTime")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(a.Input,{...i("endTime",{required:"Coupon Validation End Time"}),label:"Coupon Validation End Time",name:"endTime",type:"datetime-local",placeholder:p("CouponValidityTime")}),e.jsx(I,{errorName:m.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(v,{label:p("DiscountType")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(he,{handleProcess:u,processOption:g}),e.jsx(I,{errorName:m.discountType})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(v,{label:p("Discount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(H,{product:!0,register:i,maxValue:g?99:1e3,minValue:1,label:"Discount",name:"discountPercentage",type:"number",placeholder:g?"Percentage":"Fixed Amount",currency:g?"%":b}),e.jsx(I,{errorName:m.discountPercentage})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(v,{label:p("MinimumAmount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(H,{product:!0,register:i,maxValue:2e5,minValue:100,label:"Minimum Amount",name:"minimumAmount",type:"number",placeholder:p("MinimumAmountPlasholder"),currency:b}),e.jsx(I,{errorName:m.minimumAmount})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(v,{label:p("Published")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(me,{handleProcess:N,processOption:T}),e.jsx(I,{errorName:m.productType})]})]})]}),e.jsx(le,{id:l,title:"Coupon",isSubmitting:D})]})})]})},je=({isCheck:l,coupons:i,setIsCheck:j})=>{const[o,m]=x.useState([]),{title:S,serviceId:C,handleModalOpen:T,handleUpdate:N}=Z(),{currency:b,showDateFormat:g,globalSetting:u,showingTranslateValue:D}=Q(),k=s=>{const{id:h,checked:n}=s.target;j([...l,h]),n||j(l.filter(f=>f!==h))};return x.useEffect(()=>{const s=i==null?void 0:i.map(h=>{const n=new Date(h==null?void 0:h.updatedAt).toLocaleString("en-US",{timeZone:u==null?void 0:u.default_time_zone});return{...h,updatedDate:n}});m(s)},[i,u==null?void 0:u.default_time_zone]),e.jsxs(e.Fragment,{children:[l.length<1&&e.jsx(J,{id:C,title:S}),l.length<2&&e.jsx(G,{children:e.jsx(W,{id:C})}),e.jsx(a.TableBody,{children:o==null?void 0:o.map((s,h)=>{var n,f,w,P,F;return e.jsxs(a.TableRow,{children:[e.jsx(a.TableCell,{children:e.jsx(K,{type:"checkbox",name:(n=s==null?void 0:s.title)==null?void 0:n.en,id:s._id,handleClick:k,isChecked:l==null?void 0:l.includes(s._id)})}),e.jsxs(a.TableCell,{children:[e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.logo?e.jsx(a.Avatar,{className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none",src:s==null?void 0:s.logo,alt:"product"}):e.jsx(a.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:s==null?void 0:s.title})," "]})]})," "]}),e.jsxs(a.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm",children:[" ",s.couponCode]})," "]}),(f=s==null?void 0:s.discountType)!=null&&f.type?e.jsxs(a.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm font-semibold",children:[" ",((w=s==null?void 0:s.discountType)==null?void 0:w.type)==="percentage"?`${(P=s==null?void 0:s.discountType)==null?void 0:P.value}%`:`${b}${(F=s==null?void 0:s.discountType)==null?void 0:F.value}`]})," "]}):e.jsxs(a.TableCell,{children:[" ",e.jsx("span",{className:"text-sm font-semibold",children:" "})," "]}),e.jsx(a.TableCell,{className:"text-center",children:e.jsx(ne,{id:s._id,status:s.status})}),e.jsx(a.TableCell,{children:e.jsx("span",{className:"text-sm",children:g(s.startTime)})}),e.jsx(a.TableCell,{children:e.jsx("span",{className:"text-sm",children:g(s.endTime)})}),e.jsx(a.TableCell,{className:"align-middle ",children:_().isAfter(_(s.endTime))?e.jsx(a.Badge,{type:"danger",children:"Expired"}):e.jsx(a.Badge,{type:"success",children:"Active"})}),e.jsx(a.TableCell,{children:e.jsx(ie,{id:s==null?void 0:s._id,isCheck:l,handleUpdate:N,handleModalOpen:T,title:D(s==null?void 0:s.title)})})]},h+1)})})]})},Xe=()=>{const{t:l}=X(),{toggleDrawer:i,lang:j}=x.useContext(q),{data:o,loading:m,error:S}=ae(B.getAllCoupons),[C,T]=x.useState(!1),[N,b]=x.useState([]),{allId:g,serviceId:u,handleDeleteMany:D,handleUpdateMany:k}=Z(),{filename:s,isDisabled:h,couponRef:n,dataTable:f,serviceData:w,totalResults:P,resultsPerPage:F,handleChangePage:U,handleSelectFile:d,setSearchCoupon:y,handleSubmitCoupon:V,handleUploadMultiple:R,handleRemoveSelectFile:L}=te(o),M=()=>{T(!C),b(o==null?void 0:o.map(A=>A._id)),C&&b([])},c=()=>{y(""),n.current.value=""};return e.jsxs(e.Fragment,{children:[e.jsx(re,{children:"Coupons"}),e.jsx(J,{ids:g,setIsCheck:b,title:"Selected Coupon"}),e.jsx(de,{ids:g,title:"Coupons"}),e.jsx(G,{children:e.jsx(W,{id:u})}),e.jsx(a.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(a.CardBody,{children:e.jsxs("form",{onSubmit:V,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:[e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(a.Input,{ref:n,type:"search",placeholder:l("SearchCoupon")})}),e.jsxs("div",{className:"flex items-center gap-2 flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx("div",{className:"w-full mx-1",children:e.jsx(a.Button,{type:"submit",className:"h-12 w-full bg-emerald-700",children:"Filter"})}),e.jsx("div",{className:"w-full mx-1",children:e.jsx(a.Button,{layout:"outline",onClick:c,type:"reset",className:"px-4 md:py-1 py-2 h-12 text-sm dark:bg-gray-700",children:e.jsx("span",{className:"text-black dark:text-gray-200",children:"Reset"})})}),e.jsx("div",{className:"w-full mx-1",children:e.jsxs(a.Button,{onClick:i,className:"w-full rounded-md h-12",children:[e.jsx("span",{className:"mr-2",children:e.jsx(se,{})}),l("AddCouponsBtn")]})})]})]})})}),m?e.jsx(xe,{row:12,col:8,width:140,height:20}):S?e.jsx("span",{className:"text-center mx-auto text-red-500",children:S}):(w==null?void 0:w.length)!==0?e.jsxs(a.TableContainer,{className:"mb-8",children:[e.jsxs(a.Table,{children:[e.jsx(a.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(a.TableCell,{children:e.jsx(K,{type:"checkbox",name:"selectAll",id:"selectAll",handleClick:M,isChecked:C})}),e.jsx(a.TableCell,{children:l("CoupTblCampaignsName")}),e.jsx(a.TableCell,{children:l("CoupTblCode")}),e.jsx(a.TableCell,{children:l("Discount")}),e.jsx(a.TableCell,{className:"text-center",children:l("catPublishedTbl")}),e.jsx(a.TableCell,{children:l("CoupTblStartDate")}),e.jsx(a.TableCell,{children:l("CoupTblEndDate")}),e.jsx(a.TableCell,{children:l("CoupTblStatus")}),e.jsx(a.TableCell,{className:"text-right",children:l("CoupTblActions")})]})}),e.jsx(je,{lang:j,isCheck:N,coupons:f,setIsCheck:b})]}),e.jsx(a.TableFooter,{children:e.jsx(a.Pagination,{totalResults:P,resultsPerPage:F,onChange:U,label:"Table navigation"})})]}):e.jsx(ge,{title:"Sorry, There are no coupons right now."})]})};export{Xe as default};
