import{r as u,S as H,j as e,t as o,d as a,u as K}from"./index-BcEi1spj.js";import{l as Q,f as W}from"./Layout-U-v81hJw.js";import{d as E}from"./ProductServices-yLpjgfy_.js";import{d as M,u as X}from"./index-yCcgJFTK.js";import{T as _,D as ee,u as Y,M as $}from"./DrawerButton-w5HYixQR.js";import{u as se}from"./useFilter-aaVJznWg.js";import{P as ae}from"./PageTitle-KHFS7yVF.js";import{D as q,E as le}from"./EditDeleteButton-B6KY25Fc.js";import{C as Z,S as te,B as re}from"./BulkActionDrawer-GbJr8yfh.js";import{u as ie,E as k}from"./index.esm-VqXjgaqn.js";import{I as R}from"./InputArea-Q2156hLZ.js";import{I as L}from"./InputValue-yOhT3chk.js";import{L as D}from"./LabelArea-KTLauW-z.js";import{U as ne}from"./Uploader-B091N4e8.js";import{a as O,n as z}from"./toast-A2-s9beD.js";import{u as G}from"./useUtilsFunction-33Lhhpsl.js";import{S as de}from"./SwitchToggle-KALg7kNU.js";import{a as oe}from"./index.prod-6v_wjUoA.js";import{T as me}from"./TableLoading-XP4LTuO_.js";import{N as ce}from"./NotFound-OZWxClDm.js";import"./exportFromJSON-YB29QCxh.js";import"./httpService-u1VH4XlH.js";import"./iconBase-awMlW9ZX.js";import"./SelectLanguageTwo-emdzzKC2.js";import"./LanguageServices-8I-lsifF.js";import"./spinner-R50PTWTV.js";import"./AdminServices-4LF9doyr.js";import"./Tooltip-Ib_OQi5O.js";import"./index-y8WxlLLl.js";import"./ParentCategory-ugDAI9u_.js";import"./index-Ew3kHuDS.js";import"./tslib.es6-YYMLUA4o.js";import"./SettingServices-CwyljUlX.js";import"./index-t9pRMUQ7.js";import"./useDispatch-x9fh-lwf.js";const xe=l=>{const{isDrawerOpen:i,closeDrawer:h,setIsUpdate:n,lang:d}=u.useContext(H),[T,j]=u.useState(""),[b,w]=u.useState(d),[f,p]=u.useState({}),[g,v]=u.useState(!1),[P,s]=u.useState(!1),[C,m]=u.useState(!1),{currency:y}=G(),{register:S,handleSubmit:I,setValue:r,clearErrors:N,formState:{errors:V}}=ie(),B=async c=>{var F,A;try{m(!0);const x={title:{[b]:c.title},couponCode:c.couponCode,endTime:c.endTime,minimumAmount:c.minimumAmount,logo:T,lang:b,status:g?"show":"hide",discountType:{type:P?"percentage":"fixed",value:c.discountPercentage},productType:c.productType};if(l){const t=await E.updateCoupon(l,x);n(!0),m(!1),z(t.message),h()}else{const t=await E.addCoupon(x);n(!0),m(!1),z(t.message),h()}}catch(x){O(((A=(F=x==null?void 0:x.response)==null?void 0:F.data)==null?void 0:A.message)||(x==null?void 0:x.message)),m(!1),h()}},U=c=>{w(c),Object.keys(f).length>0&&r("title",f.title[c||"en"])};return u.useEffect(()=>{if(!i){p({}),r("title"),r("productType"),r("couponCode"),r("endTime"),r("discountPercentage"),r("minimumAmount"),j(""),N("title"),N("productType"),N("couponCode"),N("endTime"),N("discountPercentage"),N("minimumAmount"),w(d),r("language",b);return}l&&(async()=>{var c,F,A,x;try{const t=await E.getCouponById(l);t&&(p(t),r("title",t.title[b||"en"]),r("productType",t.productType),r("couponCode",t.couponCode),r("endTime",M(t.endTime).format("YYYY-MM-DD HH:mm")),r("discountPercentage",(c=t.discountType)==null?void 0:c.value),r("minimumAmount",t.minimumAmount),v(t.status==="show"),s(((F=t.discountType)==null?void 0:F.type)==="percentage"),j(t.logo))}catch(t){O(((x=(A=t==null?void 0:t.response)==null?void 0:A.data)==null?void 0:x.message)||(t==null?void 0:t.message))}})()},[l,r,i,N,b,d]),{register:S,handleSubmit:I,onSubmit:B,errors:V,setImageUrl:j,imageUrl:T,published:g,setPublished:v,currency:y,discountType:P,isSubmitting:C,setDiscountType:s,handleSelectLanguage:U}},pe=({title:l,handleProcess:i,processOption:h,product:n,handleIsCombination:d})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:`${n?"mb-3 flex flex-wrap justify-end items-center mr-8":"mb-3"}`,children:e.jsxs("div",{className:"flex flex-wrap items-center",children:[n?e.jsx("label",{className:"block text-base font-normal text-orange-500 dark:text-orange-400 mx-4",children:"Does this product have variants?"}):e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:l}),e.jsx(oe,{onChange:n?d:i,checked:h,className:"react-switch",uncheckedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingRight:45,paddingTop:1},children:"Fixed"}),width:125,height:33,handleDiameter:28,offColor:"#E53E3E",onColor:"#2F855A",checkedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingLeft:50,paddingTop:1},children:"Percentage"})})]})})}),J=({id:l})=>{const{register:i,handleSubmit:h,onSubmit:n,errors:d,setImageUrl:T,imageUrl:j,published:b,setPublished:w,currency:f,discountType:p,setDiscountType:g,isSubmitting:v,handleSelectLanguage:P}=xe(l);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative  p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 ",children:l?e.jsx(_,{register:i,title:o("UpdateCoupon"),description:o("UpdateCouponDescription")}):e.jsx(_,{register:i,title:o("AddCoupon"),description:o("AddCouponDescription")})}),e.jsx(Q.Scrollbars,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:h(n),children:[e.jsxs("div",{className:"px-6 pt-8 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:o("CouponBannerImage")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(ne,{imageUrl:j,setImageUrl:T,folder:"coupon"})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:o("CampaignName")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(R,{register:i,label:"Coupon title",name:"title",type:"text",placeholder:o("CampaignName")}),e.jsx(k,{errorName:d.title})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:o("CampaignCode")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(R,{register:i,label:"Coupon Code",name:"couponCode",type:"text",placeholder:o("CampaignCode")}),e.jsx(k,{errorName:d.couponCode})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:o("CouponValidityTime")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(a.Input,{...i("endTime",{required:"Coupon Validation End Time"}),label:"Coupon Validation End Time",name:"endTime",type:"datetime-local",placeholder:o("CouponValidityTime")}),e.jsx(k,{errorName:d.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:o("DiscountType")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(pe,{handleProcess:g,processOption:p}),e.jsx(k,{errorName:d.discountType})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:o("Discount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(L,{product:!0,register:i,maxValue:p?99:1e3,minValue:1,label:"Discount",name:"discountPercentage",type:"number",placeholder:p?"Percentage":"Fixed Amount",currency:p?"%":f}),e.jsx(k,{errorName:d.discountPercentage})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:o("MinimumAmount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(L,{product:!0,register:i,maxValue:2e5,minValue:100,label:"Minimum Amount",name:"minimumAmount",type:"number",placeholder:o("MinimumAmountPlasholder"),currency:f}),e.jsx(k,{errorName:d.minimumAmount})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(D,{label:o("Published")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(de,{handleProcess:w,processOption:b}),e.jsx(k,{errorName:d.productType})]})]})]}),e.jsx(ee,{id:l,title:"Coupon",isSubmitting:v})]})})]})},ge=({isCheck:l,coupons:i,setIsCheck:h})=>{const[n,d]=u.useState([]),{title:T,serviceId:j,handleModalOpen:b,handleUpdate:w}=Y(),{currency:f,showDateFormat:p,globalSetting:g,showingTranslateValue:v}=G(),P=s=>{const{id:C,checked:m}=s.target;h([...l,C]),m||h(l.filter(y=>y!==C))};return u.useEffect(()=>{const s=i==null?void 0:i.map(C=>{const m=new Date(C==null?void 0:C.updatedAt).toLocaleString("en-US",{timeZone:g==null?void 0:g.default_time_zone});return{...C,updatedDate:m}});d(s)},[i,g==null?void 0:g.default_time_zone]),e.jsxs(e.Fragment,{children:[l.length<1&&e.jsx(q,{id:j,title:T}),l.length<2&&e.jsx($,{children:e.jsx(J,{id:j})}),e.jsx(a.TableBody,{children:n==null?void 0:n.map((s,C)=>{var m,y,S,I,r;return e.jsxs(a.TableRow,{children:[e.jsx(a.TableCell,{children:e.jsx(Z,{type:"checkbox",name:(m=s==null?void 0:s.title)==null?void 0:m.en,id:s._id,handleClick:P,isChecked:l==null?void 0:l.includes(s._id)})}),e.jsxs(a.TableCell,{children:[e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.logo?e.jsx(a.Avatar,{className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none",src:s==null?void 0:s.logo,alt:"product"}):e.jsx(a.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:v(s==null?void 0:s.title)})," "]})]})," "]}),e.jsxs(a.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm",children:[" ",s.couponCode]})," "]}),(y=s==null?void 0:s.discountType)!=null&&y.type?e.jsxs(a.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm font-semibold",children:[" ",((S=s==null?void 0:s.discountType)==null?void 0:S.type)==="percentage"?`${(I=s==null?void 0:s.discountType)==null?void 0:I.value}%`:`${f}${(r=s==null?void 0:s.discountType)==null?void 0:r.value}`]})," "]}):e.jsxs(a.TableCell,{children:[" ",e.jsx("span",{className:"text-sm font-semibold",children:" "})," "]}),e.jsx(a.TableCell,{className:"text-center",children:e.jsx(te,{id:s._id,status:s.status})}),e.jsx(a.TableCell,{children:e.jsx("span",{className:"text-sm",children:p(s.startTime)})}),e.jsx(a.TableCell,{children:e.jsx("span",{className:"text-sm",children:p(s.endTime)})}),e.jsx(a.TableCell,{className:"align-middle ",children:M().isAfter(M(s.endTime))?e.jsx(a.Badge,{type:"danger",children:"Expired"}):e.jsx(a.Badge,{type:"success",children:"Active"})}),e.jsx(a.TableCell,{children:e.jsx(le,{id:s==null?void 0:s._id,isCheck:l,handleUpdate:w,handleModalOpen:b,title:v(s==null?void 0:s.title)})})]},C+1)})})]})},Ke=()=>{const{t:l}=K(),{toggleDrawer:i,lang:h}=u.useContext(H),{data:n,loading:d,error:T}=X(E.getAllCoupons),[j,b]=u.useState(!1),[w,f]=u.useState([]),{allId:p,serviceId:g,handleDeleteMany:v,handleUpdateMany:P}=Y(),{filename:s,isDisabled:C,couponRef:m,dataTable:y,serviceData:S,totalResults:I,resultsPerPage:r,handleChangePage:N,handleSelectFile:V,setSearchCoupon:B,handleSubmitCoupon:U,handleUploadMultiple:c,handleRemoveSelectFile:F}=se(n),A=()=>{b(!j),f(n==null?void 0:n.map(t=>t._id)),j&&f([])},x=()=>{B(""),m.current.value=""};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{children:"Coupons"}),e.jsx(q,{ids:p,setIsCheck:f,title:"Selected Coupon"}),e.jsx(re,{ids:p,title:"Coupons"}),e.jsx($,{children:e.jsx(J,{id:g})}),e.jsx(a.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(a.CardBody,{children:e.jsxs("form",{onSubmit:U,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:[e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(a.Input,{ref:m,type:"search",placeholder:l("SearchCoupon")})}),e.jsxs("div",{className:"flex items-center gap-2 flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx("div",{className:"w-full mx-1",children:e.jsx(a.Button,{type:"submit",className:"h-12 w-full bg-emerald-700",children:"Filter"})}),e.jsx("div",{className:"w-full mx-1",children:e.jsx(a.Button,{layout:"outline",onClick:x,type:"reset",className:"px-4 md:py-1 py-2 h-12 text-sm dark:bg-gray-700",children:e.jsx("span",{className:"text-black dark:text-gray-200",children:"Reset"})})}),e.jsx("div",{className:"w-full mx-1",children:e.jsxs(a.Button,{onClick:i,className:"w-full rounded-md h-12",children:[e.jsx("span",{className:"mr-2",children:e.jsx(W,{})}),l("AddCouponsBtn")]})})]})]})})}),d?e.jsx(me,{row:12,col:8,width:140,height:20}):T?e.jsx("span",{className:"text-center mx-auto text-red-500",children:T}):(S==null?void 0:S.length)!==0?e.jsxs(a.TableContainer,{className:"mb-8",children:[e.jsxs(a.Table,{children:[e.jsx(a.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(a.TableCell,{children:e.jsx(Z,{type:"checkbox",name:"selectAll",id:"selectAll",handleClick:A,isChecked:j})}),e.jsx(a.TableCell,{children:l("CoupTblCampaignsName")}),e.jsx(a.TableCell,{children:l("CoupTblCode")}),e.jsx(a.TableCell,{children:l("Discount")}),e.jsx(a.TableCell,{className:"text-center",children:l("catPublishedTbl")}),e.jsx(a.TableCell,{children:l("CoupTblStartDate")}),e.jsx(a.TableCell,{children:l("CoupTblEndDate")}),e.jsx(a.TableCell,{children:l("CoupTblStatus")}),e.jsx(a.TableCell,{className:"text-right",children:l("CoupTblActions")})]})}),e.jsx(ge,{lang:h,isCheck:w,coupons:y,setIsCheck:f})]}),e.jsx(a.TableFooter,{children:e.jsx(a.Pagination,{totalResults:I,resultsPerPage:r,onChange:N,label:"Table navigation"})})]}):e.jsx(ce,{title:"Sorry, There are no coupons right now."})]})};export{Ke as default};
